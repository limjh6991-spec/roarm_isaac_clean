<?xml version="1.0"?>
<!--
  RoArm M3 URDF - 공식 스펙 기반 완벽 버전
  
  출처: Waveshare 공식 Wiki (https://www.waveshare.com/wiki/RoArm-M3)
  생성일: 2025-10-18
  
  스펙:
  - DOF: 5+1 (5개 관절 + 그리퍼)
  - 작업 공간: 직경 1m
  - 유효 하중: 0.2kg @ 0.5m
  - 서보: ST3215 (S) / ST3235 (Pro)
  - 정확도: 0.088° (12-bit 엔코더)
  
  관절 구조:
  1. Base (joint_1): 360° 회전 (-3.14 ~ 3.14 rad)
  2. Shoulder (joint_2): 180° 회전 (-1.57 ~ 1.57 rad) - Dual-drive
  3. Elbow (joint_3): 180° 회전 (-1.57 ~ 1.57 rad)
  4. Wrist1 (joint_4): 180° 회전 (-1.57 ~ 1.57 rad)
  5. Wrist2 (joint_5): 360° 회전 (-3.14 ~ 3.14 rad)
  6. Gripper (joint_6): 135° 개폐 (1.08 ~ 3.14 rad)
-->
<robot name="roarm_m3">

  <!-- ============================================ -->
  <!-- Materials (시각화용) -->
  <!-- ============================================ -->
  <material name="black">
    <color rgba="0.1 0.1 0.1 1.0"/>
  </material>
  <material name="gray">
    <color rgba="0.5 0.5 0.5 1.0"/>
  </material>
  <material name="silver">
    <color rgba="0.75 0.75 0.75 1.0"/>
  </material>
  <material name="white">
    <color rgba="0.9 0.9 0.9 1.0"/>
  </material>

  <!-- ============================================ -->
  <!-- 0. World / Base Mount -->
  <!-- ============================================ -->
  <link name="world"/>
  
  <joint name="world_to_base" type="fixed">
    <parent link="world"/>
    <child link="base_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <!-- ============================================ -->
  <!-- 1. Base Link (고정 베이스) -->
  <!-- ============================================ -->
  <link name="base_link">
    <inertial>
      <mass value="0.5"/>
      <origin xyz="0 0 0.03" rpy="0 0 0"/>
      <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <!-- Phase 2: 실제 mesh 사용 (상대 경로로 Isaac Sim 호환) -->
        <mesh filename="../meshes/visual/base_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.03" rpy="0 0 0"/>
      <geometry>
        <!-- Collision은 primitive 유지 (성능) -->
        <cylinder radius="0.055" length="0.06"/>
      </geometry>
    </collision>
  </link>

  <!-- ============================================ -->
  <!-- 2. Joint 1: Base Rotation (360°) -->
  <!-- ============================================ -->
  <joint name="joint_1" type="continuous">
    <parent link="base_link"/>
    <child link="link_1"/>
    <origin xyz="0 0 0.06" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <!-- ST3215/ST3235 서보 스펙 -->
    <limit effort="10.0" velocity="3.14"/>  <!-- ~180 deg/s -->
    <dynamics damping="0.5" friction="0.1"/>
  </joint>

  <link name="link_1">
    <inertial>
      <mass value="0.3"/>
      <origin xyz="0 0 0.04" rpy="0 0 0"/>
      <inertia ixx="0.0008" iyy="0.0008" izz="0.0004" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/visual/link_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="gray"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.04" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.045" length="0.08"/>
      </geometry>
    </collision>
  </link>

  <!-- ============================================ -->
  <!-- 3. Joint 2: Shoulder (180°, Dual-drive) -->
  <!-- ============================================ -->
  <joint name="joint_2" type="revolute">
    <parent link="link_1"/>
    <child link="link_2"/>
    <origin xyz="0 0 0.08" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="15.0" velocity="2.62"/>  <!-- ~150 deg/s -->
    <dynamics damping="0.7" friction="0.15"/>
  </joint>

  <link name="link_2">
    <inertial>
      <!-- Shoulder는 Dual-drive로 무거움 -->
      <mass value="0.4"/>
      <origin xyz="0.08 0 0" rpy="0 1.57 0"/>
      <inertia ixx="0.002" iyy="0.0025" izz="0.0008" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/visual/link_2.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="gray"/>
    </visual>
    <collision>
      <origin xyz="0.08 0 0" rpy="0 1.57 0"/>
      <geometry>
        <cylinder radius="0.022" length="0.16"/>
      </geometry>
    </collision>
  </link>

  <!-- ============================================ -->
  <!-- 4. Joint 3: Elbow (180°) -->
  <!-- ============================================ -->
  <joint name="joint_3" type="revolute">
    <parent link="link_2"/>
    <child link="link_3"/>
    <origin xyz="0.16 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="10.0" velocity="2.62"/>
    <dynamics damping="0.5" friction="0.1"/>
  </joint>

  <link name="link_3">
    <inertial>
      <mass value="0.25"/>
      <origin xyz="0.075 0 0" rpy="0 1.57 0"/>
      <inertia ixx="0.0012" iyy="0.0015" izz="0.0005" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/visual/link_3.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="gray"/>
    </visual>
    <collision>
      <origin xyz="0.075 0 0" rpy="0 1.57 0"/>
      <geometry>
        <cylinder radius="0.018" length="0.15"/>
      </geometry>
    </collision>
  </link>

  <!-- ============================================ -->
  <!-- 5. Joint 4: Wrist1 (180°) -->
  <!-- ============================================ -->
  <joint name="joint_4" type="revolute">
    <parent link="link_3"/>
    <child link="link_4"/>
    <origin xyz="0.15 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="5.0" velocity="3.14"/>
    <dynamics damping="0.3" friction="0.05"/>
  </joint>

  <link name="link_4">
    <inertial>
      <mass value="0.15"/>
      <origin xyz="0.03 0 0" rpy="0 1.57 0"/>
      <inertia ixx="0.0003" iyy="0.0004" izz="0.0002" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/visual/link_4.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin xyz="0.03 0 0" rpy="0 1.57 0"/>
      <geometry>
        <cylinder radius="0.013" length="0.06"/>
      </geometry>
    </collision>
  </link>

  <!-- ============================================ -->
  <!-- 6. Joint 5: Wrist2 (360°) -->
  <!-- ============================================ -->
  <joint name="joint_5" type="continuous">
    <parent link="link_4"/>
    <child link="link_5"/>
    <origin xyz="0.06 0 0" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>  <!-- Roll axis -->
    <limit effort="3.0" velocity="3.14"/>
    <dynamics damping="0.2" friction="0.03"/>
  </joint>

  <link name="link_5">
    <inertial>
      <mass value="0.1"/>
      <origin xyz="0.02 0 0" rpy="0 1.57 0"/>
      <inertia ixx="0.0001" iyy="0.0001" izz="0.0001" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/visual/link_5.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin xyz="0.02 0 0" rpy="0 1.57 0"/>
      <geometry>
        <cylinder radius="0.01" length="0.04"/>
      </geometry>
    </collision>
  </link>

  <!-- ============================================ -->
  <!-- 7. Joint 6: Gripper (135°) -->
  <!-- ============================================ -->
  <joint name="joint_6" type="revolute">
    <parent link="link_5"/>
    <child link="gripper_base"/>
    <origin xyz="0.04 0 0" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>  <!-- Gripper open/close axis -->
    <limit lower="1.08" upper="3.14" effort="2.0" velocity="2.0"/>
    <dynamics damping="0.1" friction="0.02"/>
  </joint>

  <link name="gripper_base">
    <inertial>
      <mass value="0.05"/>
      <origin xyz="0 0 0.02" rpy="0 0 0"/>
      <inertia ixx="0.00005" iyy="0.00005" izz="0.00003" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.02" rpy="0 0 0"/>
      <geometry>
        <box size="0.03 0.02 0.04"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.02" rpy="0 0 0"/>
      <geometry>
        <box size="0.025 0.018 0.04"/>
      </geometry>
    </collision>
  </link>

  <!-- ============================================ -->
  <!-- 8. Gripper Fingers (Simplified) -->
  <!-- ============================================ -->
  <joint name="gripper_left_finger_joint" type="fixed">
    <parent link="gripper_base"/>
    <child link="gripper_left_finger"/>
    <origin xyz="0 0.015 0.04" rpy="0 0 0"/>
  </joint>

  <link name="gripper_left_finger">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0.015" rpy="0 0 0"/>
      <inertia ixx="0.000005" iyy="0.000005" izz="0.000002" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.015" rpy="0 0 0"/>
      <geometry>
        <box size="0.01 0.005 0.03"/>
      </geometry>
      <material name="white"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.015" rpy="0 0 0"/>
      <geometry>
        <box size="0.008 0.004 0.03"/>
      </geometry>
    </collision>
  </link>

  <joint name="gripper_right_finger_joint" type="fixed">
    <parent link="gripper_base"/>
    <child link="gripper_right_finger"/>
    <origin xyz="0 -0.015 0.04" rpy="0 0 0"/>
  </joint>

  <link name="gripper_right_finger">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0.015" rpy="0 0 0"/>
      <inertia ixx="0.000005" iyy="0.000005" izz="0.000002" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.015" rpy="0 0 0"/>
      <geometry>
        <box size="0.01 0.005 0.03"/>
      </geometry>
      <material name="white"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.015" rpy="0 0 0"/>
      <geometry>
        <box size="0.008 0.004 0.03"/>
      </geometry>
    </collision>
  </link>

  <!-- ============================================ -->
  <!-- 9. End Effector Frame (Tool Center Point) -->
  <!-- ============================================ -->
  <joint name="gripper_to_tcp" type="fixed">
    <parent link="gripper_base"/>
    <child link="tcp"/>
    <origin xyz="0 0 0.07" rpy="0 0 0"/>
  </joint>

  <link name="tcp">
    <!-- Virtual link for tool center point -->
  </link>

</robot>
