<?xml version="1.0"?>
<!-- 
  RoArm-M3 Complete URDF with STL Meshes
  
  작성일: 2025-10-17
  기반: roarm_m3.clean.urdf (실제 관절 축 방향 포함)
  개선사항:
  - STL mesh 포함 (실제 형상)
  - 정확한 관절 축 방향 (rpy 설정)
  - 실측 기반 inertia 값
  - 적절한 damping/friction
  
  출처: https://www.waveshare.com/wiki/RoArm-M3
  
  Joint 범위:
  - Joint 1 (Base):     ±180° (±3.14 rad) - Z축 회전
  - Joint 2 (Shoulder): ±90°  (±1.57 rad) - Y축 회전
  - Joint 3 (Elbow):    -57° ~ 169° (-1.0 ~ 2.95 rad) - Z축 회전
  - Joint 4 (Wrist1):   ±90°  (±1.57 rad) - Z축 회전
  - Joint 5 (Wrist2):   ±180° (±3.14 rad) - Z축 회전
  - Joint 6 (Gripper):  0° ~ 86° (0 ~ 1.5 rad) - Z축 회전
-->
<robot name="roarm_m3">

  <!-- ==================== Materials ==================== -->
  <material name="black">
    <color rgba="0.15 0.15 0.15 1.0"/>
  </material>
  
  <material name="dark_grey">
    <color rgba="0.3 0.3 0.3 1.0"/>
  </material>
  
  <material name="light_grey">
    <color rgba="0.7 0.7 0.7 1.0"/>
  </material>
  
  <material name="blue">
    <color rgba="0.2 0.4 0.8 1.0"/>
  </material>
  
  <material name="orange">
    <color rgba="1.0 0.5 0.0 1.0"/>
  </material>
  
  <material name="tcp_marker">
    <color rgba="1.0 0.6 0.0 1.0"/>
  </material>

  <!-- ==================== World Link (고정 기준점) ==================== -->
  <link name="world" />

  <!-- ==================== Base Link ==================== -->
  <link name="base_link">
    <inertial>
      <origin xyz="-0.0068 0 -0.03" rpy="0 0 0" />
      <mass value="0.2562183" />
      <inertia ixx="0.00029211" ixy="0" ixz="0" 
               iyy="0.00035719" iyz="0" 
               izz="0.000349421" />
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/base_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="dark_grey"/>
    </visual>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/base_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- ==================== Link 1 (Base Rotation) ==================== -->
  <link name="link1">
    <inertial>
      <origin xyz="0 0 0.037" rpy="0 0 0" />
      <mass value="0.0729177" />
      <inertia ixx="4.68465E-05" ixy="0" ixz="0" 
               iyy="3.32107E-05" iyz="0" 
               izz="5.01023E-05" />
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="blue"/>
    </visual>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- ==================== Link 2 (Shoulder) ==================== -->
  <link name="link2">
    <inertial>
      <origin xyz="0.119 0.012247 -0.0001" rpy="0 0 0"/>
      <mass value="0.0703216" />
      <inertia ixx="5.46501E-05" ixy="0" ixz="0" 
               iyy="0.000423091" iyz="0" 
               izz="0.000404557" />
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link2.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="orange"/>
    </visual>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link2.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- ==================== Link 3 (Elbow) ==================== -->
  <link name="link3">
    <inertial>
      <origin xyz="-0.0015 -0.0765 0.00505" rpy="0 0 0"/>
      <mass value="0.021608"/>
      <inertia ixx="6.37699E-05" iyy="3.67026E-06" izz="6.28965E-05" 
               ixy="0" iyz="0" ixz="0"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link3.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="blue"/>
    </visual>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link3.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- ==================== Link 4 (Wrist1) ==================== -->
  <link name="link4">
    <inertial>
      <origin xyz="-0.0015 -0.022 -0.00075" rpy="0 0 0"/>
      <mass value="0.0099933"/>
      <inertia ixx="4.53979E-06" iyy="3.78103E-06" izz="5.60238E-06" 
               ixy="-0.0" iyz="-0.0" ixz="0.0"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link4.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="orange"/>
    </visual>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link4.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- ==================== Link 5 (Wrist2) ==================== -->
  <link name="link5">
    <inertial>
      <origin xyz="-0.0078 0 0.0595" rpy="0 0 0"/>
      <mass value="0.0153928"/>
      <inertia ixx="2.02869E-05" iyy="2.14427E-05" izz="4.39495E-06" 
               ixy="-0.0" iyz="0" ixz="0"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link5.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="blue"/>
    </visual>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/link5.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- ==================== Gripper Link ==================== -->
  <link name="gripper_link">
    <inertial>
      <origin xyz="0.027 0.0027 -0.018935" rpy="0 0 0"/>
      <mass value="0.0028708" />
      <inertia ixx="5.23216E-07" ixy="0" ixz="0" 
               iyy="1.82071E-06" iyz="0" 
               izz="1.60231E-06" />
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/gripper_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="dark_grey"/>
    </visual>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="../meshes/roarm_m3/gripper_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- ==================== Tool Center Point (TCP) ==================== -->
  <link name="hand_tcp">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="0.0005"/>
      <inertia ixx="2e-08" ixy="0" ixz="0" 
               iyy="2e-08" iyz="0" 
               izz="2e-08"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="0.01"/>
      </geometry>
      <material name="tcp_marker"/>
    </visual>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="0.01"/>
      </geometry>
    </collision>
  </link>

  <!-- ==================== Joints ==================== -->
  
  <!-- World Fixed Joint -->
  <joint name="world_to_base_link" type="fixed">
    <origin xyz="0.0 0.0 0.0701" rpy="0 0 0"/>
    <parent link="world"/>
    <child link="base_link"/>
    <axis xyz="0 0 1"/>
  </joint>

  <!-- Joint 1: Base Rotation (Z-axis, 360°) -->
  <joint name="base_link_to_link1" type="revolute">
    <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
    <parent link="base_link"/>
    <child link="link1"/>
    <axis xyz="0 0 1"/>
    <limit lower="-3.1416" upper="3.1416" effort="10.0" velocity="2.0" />
    <dynamics damping="0.7" friction="0.5"/>
  </joint>

  <!-- Joint 2: Shoulder (Y-axis after rotation, ±90°) -->
  <joint name="link1_to_link2" type="revolute">
    <origin xyz="0.0 0.0 0.051959" rpy="-1.5708 -1.5708 0"/>
    <parent link="link1"/>
    <child link="link2"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.5708" upper="1.5708" effort="15.0" velocity="2.0" />
    <dynamics damping="0.8" friction="0.6"/>
  </joint>

  <!-- Joint 3: Elbow (Z-axis after rotation, -57° ~ 169°) -->
  <joint name="link2_to_link3" type="revolute">
    <origin xyz="0.236815 0.030002 0" rpy="0 0 1.5708"/>
    <parent link="link2"/>
    <child link="link3"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.0" upper="2.95" effort="10.0" velocity="2.5" />
    <dynamics damping="0.7" friction="0.5"/>
  </joint>

  <!-- Joint 4: Wrist1 (Z-axis, ±90°) -->
  <joint name="link3_to_link4" type="revolute">
    <origin xyz="0.0 -0.144586 0" rpy="0 0 0"/>
    <parent link="link3"/>
    <child link="link4"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.5708" upper="1.5708" effort="8.0" velocity="3.0" />
    <dynamics damping="0.5" friction="0.3"/>
  </joint>

  <!-- Joint 5: Wrist2 (Z-axis after rotation, 360°) -->
  <joint name="link4_to_link5" type="revolute">
    <origin xyz="0.015147 -0.053653 0" rpy="1.5708 1.5708 0"/>
    <parent link="link4"/>
    <child link="link5"/>
    <axis xyz="0 0 1"/>
    <limit lower="-3.1416" upper="3.1416" effort="5.0" velocity="3.5" />
    <dynamics damping="0.3" friction="0.2"/>
  </joint>

  <!-- Joint 6: Gripper (Z-axis after rotation, 0° ~ 86°) -->
  <joint name="link5_to_gripper_link" type="revolute">
    <origin xyz="0.0 0.018821 0.052035" rpy="-1.5708 -1.5708 0"/>
    <parent link="link5"/>
    <child link="gripper_link"/>
    <axis xyz="0 0 1"/>
    <limit lower="0.0" upper="1.5" effort="5.0" velocity="3.0" />
    <dynamics damping="0.2" friction="0.1"/>
  </joint>

  <!-- TCP Fixed Joint -->
  <joint name="link5_to_hand_tcp" type="fixed">
    <origin xyz="0 0 0.115428" rpy="1.5708 -1.5708 0"/>
    <parent link="link5"/>
    <child link="hand_tcp"/>
    <axis xyz="0 0 0"/>
  </joint>

</robot>
